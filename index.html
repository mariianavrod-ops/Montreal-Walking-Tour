<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Montreal Walking Tour</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #020617;
      color: #e5e7eb;
    }
    .layout {
      display: flex;
      height: 100vh;
    }
    .sidebar {
      width: 35%;
      min-width: 280px;
      max-width: 420px;
      padding: 16px;
      background: #111827;
      border-right: 1px solid #1f2937;
      overflow-y: auto;
    }
    .map {
      flex: 1;
    }
    #map {
      width: 100%;
      height: 100%;
    }

    h1 {
      margin: 0 0 4px;
      font-size: 1.6rem;
    }
    h2 {
      margin: 0 0 12px;
      font-size: 0.95rem;
      font-weight: 400;
      color: #9ca3af;
    }

    .location-card {
      background: #1f2937;
      border-radius: 16px;
      padding: 10px 12px;
      margin-bottom: 10px;
      border: 1px solid #374151;
      cursor: pointer;
      transition: background 0.15s, transform 0.15s, border-color 0.15s;
    }
    .location-card:hover {
      background: #0f172a;
      transform: translateY(-1px);
      border-color: #4b5563;
    }
    .location-header {
      display: flex;
      align-items: center;
      margin-bottom: 4px;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 22px;
      height: 22px;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 700;
      background: #f97316;
      color: white;
      margin-right: 8px;
      flex-shrink: 0;
    }
    .location-title {
      font-weight: 600;
      font-size: 0.98rem;
    }
    .location-meta {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-bottom: 4px;
    }
    .location-desc {
      font-size: 0.86rem;
      line-height: 1.35;
      color: #e5e7eb;
    }

    .hint {
      font-size: 0.78rem;
      color: #9ca3af;
      margin-bottom: 10px;
    }
  </style>
</head>

<body>
  <div class="layout">
    <aside class="sidebar">
      <h1>Montreal Walking Tour</h1>
      <h2>Place des Montréalaises, Grey Nuns, Chez Doris, Square Dorchester & Parc des Faubourgs</h2>
      <p class="hint">
        Click a card or a marker to see details. Click multiple points to trace your own route.
      </p>
      <div id="location-list"></div>
    </aside>

    <div class="map">
      <div id="map"></div>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <script>
    // ---- 1. Your locations ----
    // NOTE: coordinates are approximate and easy to tweak:
    // In Google Maps, right-click a point → “What’s here?” → copy the lat, lng.

    const locations = [
      {
        id: 1,
        name: "Place des Montréalaises",
        coords: [45.51248913220803, -73.54886299570519], // official toponymy coords
        address: "Near Champ-de-Mars metro",
        description:
          "New square honouring Montreal women, reconnecting downtown with Old Montreal."
      },
      {
        id: 2,
        name: "Grey Nuns Motherhouse",
        coords: [45.49719409448369, -73.57049345281159],
        address: "1190 Rue Guy",
        description:
          "Former Grey Nuns convent (now Concordia residence); key site in the city’s religious and social history."
      },
      {
        id: 3,
        name: "Chez Doris",
        coords: [45.491344767161735, -73.58302151953741], // TODO: refine using Google Maps
        address: "1430 Rue Chomedey",
        description:
          "Day shelter and support space for women in difficulty in Shaughnessy Village."
      },
      {
        id: 4,
        name: "Square Dorchester",
        coords: [45.50274410180007, -73.56238203139671],
        address: "2903 Rue Peel",
        description:
          "Historic downtown green space and meeting point, surrounded by major civic and commercial buildings."
      },
      {
        id: 5,
        name: "Parc des Faubourgs",
        coords: [45.52913298963447, -73.54789735029865],
        address: "1872 Rue Dorion",
        description:
          "Park near the Jacques-Cartier Bridge, tied to Centre-Sud’s working-class and industrial history."
      }
    ];

    // ---- 2. Initialise the map ----
    const map = L.map("map").setView([45.505, -73.565], 13);

    // OpenStreetMap tiles
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: "&copy; OpenStreetMap contributors"
    }).addTo(map);

    // ---- 3. Add markers ----
    const markerById = {};
    const boundsPoints = [];

    locations.forEach((loc) => {
      const marker = L.marker(loc.coords)
        .addTo(map)
        .bindPopup(`<b>${loc.id}. ${loc.name}</b><br>${loc.address}`);

      markerById[loc.id] = marker;
      boundsPoints.push(loc.coords);
    });

    if (boundsPoints.length) {
      map.fitBounds(boundsPoints, { padding: [40, 40] });
    }

    // ---- 4. Sidebar cards ----
    const listEl = document.getElementById("location-list");

    locations.forEach((loc) => {
      const card = document.createElement("article");
      card.className = "location-card";
      card.innerHTML = `
        <div class="location-header">
          <span class="badge">${loc.id}</span>
          <div class="location-title">${loc.name}</div>
        </div>
        <div class="location-meta">${loc.address}</div>
        <p class="location-desc">${loc.description}</p>
      `;

      card.addEventListener("click", () => {
        const marker = markerById[loc.id];
        map.setView(loc.coords, 16);
        marker.openPopup();
        addPointToRoute(loc.coords);
      });

      listEl.appendChild(card);
    });

    // ---- 5. Simple “route drawing” between clicked points ----
    let routePoints = [];
    let routeLine = null;

    function addPointToRoute(latlng) {
      routePoints.push(latlng);

      if (routeLine) {
        routeLine.setLatLngs(routePoints);
      } else if (routePoints.length > 1) {
        routeLine = L.polyline(routePoints, { weight: 4 }).addTo(map);
      }
    }

    // When you click on a marker, also extend the route
    Object.values(markerById).forEach((marker) => {
      marker.on("click", (e) => {
        addPointToRoute(e.latlng);
      });
    });

    // (Optional) expose a reset function in the console: clear the route
    window.clearRoute = function () {
      routePoints = [];
      if (routeLine) {
        map.removeLayer(routeLine);
        routeLine = null;
      }
    };
  </script>
</body>
</html>
