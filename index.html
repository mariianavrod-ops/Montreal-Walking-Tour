<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Montreal Walking Tour</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    crossorigin=""
  />

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #020617;
      color: #e5e7eb;
    }
    .layout {
      display: flex;
      height: 100vh;
    }
    .sidebar {
      width: 40%;
      min-width: 320px;
      max-width: 460px;
      padding: 16px;
      background: #050816;
      border-right: 1px solid #1f2937;
      overflow-y: auto;
    }
    .map {
      flex: 1;
    }
    #map {
      width: 100%;
      height: 100%;
    }

    h1 {
      margin: 0 0 4px;
      font-size: 1.6rem;
    }
    h2 {
      margin: 0 0 12px;
      font-size: 0.95rem;
      font-weight: 400;
      color: #9ca3af;
    }

    .location-card {
      background: radial-gradient(circle at top left, #1d2538, #020617);
      border-radius: 20px;
      padding: 12px 14px 16px;
      margin-bottom: 14px;
      border: 1px solid #1f2937;
      cursor: pointer;
      transition: background 0.15s, transform 0.15s, box-shadow 0.15s;
      box-shadow: 0 8px 18px rgba(0,0,0,0.4);
    }
    .location-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.55);
      border-color: #4b5563;
    }

    .location-header {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 26px;
      height: 26px;
      border-radius: 999px;
      font-size: 0.9rem;
      font-weight: 700;
      background: #f97316;
      color: white;
      margin-right: 8px;
      flex-shrink: 0;
    }
    .location-title {
      font-weight: 600;
      font-size: 1rem;
    }
    .location-meta {
      font-size: 0.78rem;
      color: #9ca3af;
      margin-bottom: 6px;
    }
    .location-image {
      width: 100%;
      border-radius: 16px;
      margin-bottom: 8px;
      max-height: 220px;
      object-fit: cover;
      border: 1px solid #374151;
    }
    .location-desc {
      font-size: 0.9rem;
      line-height: 1.5;
      margin-bottom: 8px;
      color: #e5e7eb;
    }

    .tag-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 600;
      margin-bottom: 2px;
      display: block;
    }

    .theme-box {
      background: linear-gradient(135deg, #7c2d12, #b45309);
      border-radius: 14px;
      padding: 8px 10px;
      margin-bottom: 6px;
      font-size: 0.85rem;
      color: #fef9c3;
    }
  
       .hint {
      font-size: 0.78rem;
      color: #9ca3af;
      margin-bottom: 10px;
    }

    .welcome-panel {
      background: #020617;
      border-radius: 18px;
      padding: 20px 22px;
      margin-bottom: 24px;
      border: 1px solid #1f2937;
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.55);
    }

    .welcome-panel h3 {
      margin: 0 0 10px;
      font-size: 1.4rem;
      color: #f9fafb;
    }

    .welcome-panel p {
      margin: 0 0 10px;
      font-size: 0.9rem;
      color: #9ca3af;
    }

    .welcome-route {
      margin-top: 10px;
      padding: 12px 16px;
      border-radius: 14px;
      border: 2px solid #38bdf8; /* cyan outline like the example */
      background: #020827;
      font-size: 0.9rem;
      color: #e5e7eb;
    }

    .welcome-route p {
      margin: 2px 0;
    }

    .welcome-route strong {
      font-weight: 700;
    }

    .welcome-clear {
      margin-top: 16px;
      padding: 10px 22px;
      border-radius: 10px;
      border: 1px solid #4b5563;
      background: #111827;
      color: #e5e7eb;
      font-size: 0.9rem;
      cursor: pointer;
    }

    .welcome-clear:hover {
      background: #1f2937;
    }
    .welcome-clear:hover {
      background: #1f2937;
    }

    /* --- Read-more toggle (clean version) --- */
    .read-more-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.25s ease;
    }

    .read-more-content.open {
      max-height: 500px;
    }

    .read-more-toggle {
      width: 100%;
      margin-top: 8px;
      border: none;
      background: #111827;
      color: #f9fafb;
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 6px 0;
      border-radius: 999px;
    }

    .read-more-toggle:hover {
      background: #1f2937;
    }
  </style>
</head>

<body>
  <div class="layout">
    <aside class="sidebar">
      <h1>Montreal Walking Tour</h1>
      <h2>Erased Women of Montreal: A Walking Tour</h2>
     <p class="hint">
  Click a card or a marker to centre the map. The boxes highlight a key theme for each site.
</p>
<div class="welcome-panel">
  <h3>Welcome to Your Walking Tour</h3>
  <p>
    Click on any location marker to get started. Then click another marker to see the walking route.
  </p>

  <div class="welcome-route">
    <p id="route-line">
      <strong>Route:</strong> Select a starting site → then choose another site.
    </p>
    <p id="route-info">
      <strong>Distance:</strong> — | <strong>Walking time:</strong> — 
    </p>
  </div>

  <button class="welcome-clear">Clear Route</button>
</div>

<div id="location-list"></div>
    </aside>

    <div class="map">
      <div id="map"></div>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    crossorigin=""
  ></script>

  <script>
    /* ---- 1. Locations with description + theme ---- */
    const locations = [
      {
        id: 1,
        name: "Place des Montréalaises",
        coords: [45.51349251464839, -73.54877633843134],
        address: "1 Pl. Ville-Marie, Montréal, QC H3B 2B6",
        image: "place-des-montrealaises.jpg",
        description:
          "Place des Montréalaises, inaugurated on May 16, 2025, is a new public space at Champ-de-Mars that links Old Montreal to the city centre and acts as a feminist site of memory. By incorporating symbolic elements like a mirrored installation engraved with the names of seven women: Jeanne Mance, Marie-Josèphe Angélique, Myra Cree, Agnès Vautier, Jessie Maxwell Smith, Ida Roth Steinberg, and Idola St-Jean, as well as the 14 victims of the École Polytechnique feminicide, the space honours the women who shaped Montreal. The nearby Place Marie-Josèphe-Angélique was similarly renovated to draw attention to Canada's history of gendered violence and enslavement. When taken as a whole, these areas highlight the histories of women who have long been underrepresented in Montreal's urban environment.",
        theme:
          "The square shows how naming practices can repair erasures: women’s lives, which used to be absent from official stone and street signs, are brought into the centre of the city’s visual story."
      },
      {
        id: 2,
        name: "Grey Nuns Motherhouse",
        coords: [45.49533879399124, -73.57015843487274],
        address: "1190 Rue Guy",
        image: "grey-nuns.jpg",
        description:
          "The Grey Nuns were a Catholic women’s religious order whose members devoted their lives to care work that established Montreal’s early social welfare system. They maintained hospitals, orphanages, seniors’ homes, and shelters for the needy, providing medical treatment, education, food, and lodging long before the state supplied these services. Inside the Motherhouse, they cooked, cleaned, nursed the sick, taught children, cared for unwed mothers, and assisted those facing poverty, disease, and disability. Their work formed the backbone of Montreal’s institutional care, but it was carried out almost entirely within the restricted space of the convent and framed as domestic or religious duty rather than civic leadership.",
        theme:
          "The Motherhouse reveals how women’s unpaid religious labour built much of Montreal’s social safety net, even while remaining under male ecclesial and state authority."
      },
      {
        id: 3,
        name: "Chez Doris",
        coords: [45.494730476445284, -73.59458908240381],
        address: "1430 Rue Chomedey",
        image: "chez-doris.jpg",
        description:
          "In the 1970s, Doris, a homeless woman, told a community worker that women like her needed a place to go without prying eyes or too many questions. Shortly after this interview she was murdered, and her story inspired the founding of Chez Doris in 1977 as a daytime refuge for women facing homelessness, violence, and poverty. Today, Chez Doris has grown into several service points offering safety, meals, counselling, and practical support to help women regain stability and autonomy.",
        theme:
          "Placed only a few blocks from former religious institutions, Chez Doris shows how the work of care has shifted from convents to community organizations, while structural inequalities that produce gendered precarity remain."
      },
      {
        id: 4,
        name: "Square Dorchester",
        coords: [45.503628717394356, -73.55788369114875],
        address: "Downtown Montreal",
        image: "square-dorchester.jpg",
        description:
          "Square Dorchester is one of downtown Montréal’s most symbolically rich public spaces, filled with monuments that tell an official national story. The central equestrian monument to Lord Strathcona and the Boer War commemorates male military heroism and imperial participation, while no women are represented in the square’s major statues. In a city where only a small fraction of named spaces honour women, Dorchester Square exemplifies how public memory has celebrated male political and military figures while ignoring women’s contributions to urban life.",
        theme:
          "Square Dorchester highlights the imbalance between monumental male figures in stone and the almost invisible histories of women, service workers, and unhoused people who also occupy this space."
      },
      {
        id: 5,
        name: "Parc des Faubourgs",
        coords: [45.52801980243481, -73.55319782666079],
        address: "Near Papineau station, Centre-Sud",
        image: "parc-des-faubourgs.jpg",
        description:
          "Parc des Faubourgs lies near the Jacques-Cartier Bridge, bordered by busy roads and older working-class streets. Its name recalls historic working-class faubourgs such as Sainte-Marie and the Faubourg-à-m’lasse. Recently, the park has hosted the Refus Local encampment, where advocates protested the dismantling of homeless camps during the housing crisis.",
        theme:
          "Parc des Faubourgs makes visible how housing precarity, addiction, and police surveillance shape public space, often putting already vulnerable people—especially women experiencing homelessness—in even more danger while their stories remain absent from official commemoration."
      }
    ];
      /* ---- 2. Init map ---- */
  const map = L.map("map").setView([45.505, -73.565], 13);

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19
  }).addTo(map);

  const markerById = {};
  const boundsPoints = [];

  // elements for the sidebar + route box
  const listEl = document.getElementById("location-list");
  const routeLineEl = document.getElementById("route-line");
  const routeInfoEl = document.getElementById("route-info");
  const clearBtn = document.querySelector(".welcome-clear");

  let startLocation = null;
  let routeLineLayer = null;

  /* ---- 3. Add markers + cards ---- */
  locations.forEach((loc) => {
    // marker
    const marker = L.marker(loc.coords)
      .addTo(map)
      .bindPopup(`<b>${loc.name}</b><br>${loc.address}`);

    markerById[loc.id] = marker;
    boundsPoints.push(loc.coords);

    // when you click a marker, update route box
    marker.on("click", () => {
      handleLocationClick(loc);
    });

    // card
    const card = document.createElement("article");
    card.className = "location-card";

    card.innerHTML = `
  <div class="location-header">
    <span class="badge">${loc.id}</span>
    <div class="location-title">${loc.name}</div>
  </div>
  <div class="location-meta">${loc.address}</div>
  <img class="location-image" src="${loc.image}" alt="${loc.name}">
  
  <div class="read-more-content">
    <p class="location-desc">${loc.description}</p>
    <div class="theme-box">
      <span class="tag-label">Key Theme</span>
      ${loc.theme}
    </div>
  </div>
  <button class="read-more-toggle" aria-label="Toggle details">▼</button>
`;
        // read-more arrow behaviour
    const toggle = card.querySelector(".read-more-toggle");
    const content = card.querySelector(".read-more-content");

    // start collapsed
    content.classList.remove("open");
    toggle.textContent = "▼";

    toggle.addEventListener("click", (event) => {
      event.stopPropagation(); // don’t trigger the card click
      const isOpen = content.classList.toggle("open");
      toggle.textContent = isOpen ? "▲" : "▼";
    });

        // clicking the card recenters the map + updates route
    card.addEventListener("click", () => {
      handleLocationClick(loc);
      const marker = markerById[loc.id];
      map.setView(loc.coords, 16);
      marker.openPopup();
    });

    listEl.appendChild(card);
  }); // closes locations.forEach

  // fit map to all points
  if (boundsPoints.length) {
    map.fitBounds(boundsPoints, { padding: [40, 40] });
  }

  /* ---- 4. Route Logic ---- */

  function handleLocationClick(loc) {
    // first click: choose starting site
    if (!startLocation) {
      startLocation = loc;
      routeLineEl.innerHTML =
        `<strong>Route:</strong> ${loc.name} → select another site.`;
      routeInfoEl.innerHTML =
        `<strong>Distance:</strong> — | <strong>Walking time:</strong> —`;
      // clear any existing line
      if (routeLineLayer) {
        map.removeLayer(routeLineLayer);
        routeLineLayer = null;
      }
      return;
    }

    // second click: draw line + show distance/time
    const distanceKm = haversineKm(startLocation.coords, loc.coords);
    const walkingTimeMin = Math.round((distanceKm / 5) * 60); // 5 km/h

    routeLineEl.innerHTML =
      `<strong>Route:</strong> ${startLocation.name} → ${loc.name}`;
    routeInfoEl.innerHTML =
      `<strong>Distance:</strong> ${distanceKm.toFixed(2)} km | ` +
      `<strong>Walking time:</strong> ${walkingTimeMin} min`;

    // draw / replace line
    if (routeLineLayer) {
      map.removeLayer(routeLineLayer);
    }
    routeLineLayer = L.polyline(
      [startLocation.coords, loc.coords],
      { color: "#38bdf8", weight: 4 }
    ).addTo(map);

    map.fitBounds(routeLineLayer.getBounds(), { padding: [40, 40] });

    // next click will start a new route
    startLocation = null;
  }

  function haversineKm(a, b) {
    const R = 6371; // Earth radius in km
    const [lat1, lon1] = a;
    const [lat2, lon2] = b;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const sLat1 = Math.sin(dLat / 2);
    const sLat2 = Math.sin(dLon / 2);
    const aa =
      sLat1 * sLat1 +
      Math.cos(lat1 * Math.PI / 180) *
      Math.cos(lat2 * Math.PI / 180) *
      sLat2 * sLat2;
    const c = 2 * Math.atan2(Math.sqrt(aa), Math.sqrt(1 - aa));
    return R * c;
  }

  function clearRoute() {
    startLocation = null;
    if (routeLineLayer) {
      map.removeLayer(routeLineLayer);
      routeLineLayer = null;
    }
    routeLineEl.innerHTML =
      `<strong>Route:</strong> Select a starting site → then choose another site.`;
    routeInfoEl.innerHTML =
      `<strong>Distance:</strong> — | <strong>Walking time:</strong> —`;
  }

  clearBtn.addEventListener("click", clearRoute);
  </script>
</body>
</html>
