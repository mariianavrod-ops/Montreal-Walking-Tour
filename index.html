<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Montreal Walking Tour</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    crossorigin=""
  />

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #020617;
      color: #e5e7eb;
    }
    .layout {
      display: flex;
      height: 100vh;
    }
    .sidebar {
      width: 40%;
      min-width: 320px;
      max-width: 460px;
      padding: 16px;
      background: #050816;
      border-right: 1px solid #1f2937;
      overflow-y: auto;
    }
    .map {
      flex: 1;
    }
    #map {
      width: 100%;
      height: 100%;
    }

    h1 {
      margin: 0 0 4px;
      font-size: 1.6rem;
    }
    h2 {
      margin: 0 0 12px;
      font-size: 0.95rem;
      font-weight: 400;
      color: #9ca3af;
    }

    .location-card {
      background: radial-gradient(circle at top left, #1d2538, #020617);
      border-radius: 20px;
      padding: 12px 14px 16px;
      margin-bottom: 14px;
      border: 1px solid #1f2937;
      cursor: pointer;
      transition: background 0.15s, transform 0.15s, box-shadow 0.15s;
      box-shadow: 0 8px 18px rgba(0,0,0,0.4);
    }
    .location-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.55);
      border-color: #4b5563;
    }

    .location-header {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 26px;
      height: 26px;
      border-radius: 999px;
      font-size: 0.9rem;
      font-weight: 700;
      background: #f97316;
      color: white;
      margin-right: 8px;
      flex-shrink: 0;
    }
    .location-title {
      font-weight: 600;
      font-size: 1rem;
    }
    .location-meta {
      font-size: 0.78rem;
      color: #9ca3af;
      margin-bottom: 6px;
    }
    .location-image {
      width: 100%;
      border-radius: 16px;
      margin-bottom: 8px;
      max-height: 220px;
      object-fit: cover;
      border: 1px solid #374151;
    }
    .location-desc {
      font-size: 0.9rem;
      line-height: 1.5;
      margin-bottom: 8px;
      color: #e5e7eb;
    }
.read-more-content {
  max-height: 4.2em;          /* about 3 lines */
  overflow: hidden;
  transition: max-height 0.25s ease;
}

.read-more-content.open {
  max-height: 1000px;         /* big enough to show all text */
}

.read-more-toggle {
  margin-top: 4px;
  font-size: 0.8rem;
  color: #9ca3af;
  cursor: pointer;
  user-select: none;
  text-align: right;
}

.read-more-toggle.open {
  transform: rotate(180deg);  /* optional little flip animation */
}
    .tag-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 600;
      margin-bottom: 2px;
      display: block;
    }

    .theme-box {
      background: linear-gradient(135deg, #7c2d12, #b45309);
      border-radius: 14px;
      padding: 8px 10px;
      margin-bottom: 6px;
      font-size: 0.85rem;
      color: #fef9c3;
    }
    /* --- Read More Arrow --- */
.read-more-toggle {
  cursor: pointer;
  font-size: 1.2rem;
  color: #9ca3af;
  margin-top: 6px;
  transition: transform 0.3s ease;
}

.read-more-toggle.open {
  transform: rotate(180deg);
}

.read-more-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.35s ease;
}

.read-more-content.open {
  max-height: 500px; /* enough room for your text */
}
       .hint {
      font-size: 0.78rem;
      color: #9ca3af;
      margin-bottom: 10px;
    }

    .welcome-panel {
      background: #020617;
      border-radius: 18px;
      padding: 20px 22px;
      margin-bottom: 24px;
      border: 1px solid #1f2937;
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.55);
    }

    .welcome-panel h3 {
      margin: 0 0 10px;
      font-size: 1.4rem;
      color: #f9fafb;
    }

    .welcome-panel p {
      margin: 0 0 10px;
      font-size: 0.9rem;
      color: #9ca3af;
    }

    .welcome-route {
      margin-top: 10px;
      padding: 12px 16px;
      border-radius: 14px;
      border: 2px solid #38bdf8; /* cyan outline like the example */
      background: #020827;
      font-size: 0.9rem;
      color: #e5e7eb;
    }

    .welcome-route p {
      margin: 2px 0;
    }

    .welcome-route strong {
      font-weight: 700;
    }

    .welcome-clear {
      margin-top: 16px;
      padding: 10px 22px;
      border-radius: 10px;
      border: 1px solid #4b5563;
      background: #111827;
      color: #e5e7eb;
      font-size: 0.9rem;
      cursor: pointer;
    }

    .welcome-clear:hover {
      background: #1f2937;
    }
  </style>
</head>

<body>
  <div class="layout">
    <aside class="sidebar">
      <h1>Montreal Walking Tour</h1>
      <h2>Erased Women of Montreal: A Walking Tour</h2>
     <p class="hint">
  Click a card or a marker to centre the map. The boxes highlight a key theme for each site.
</p>
<div class="welcome-panel">
  <h3>Welcome to Your Walking Tour</h3>
  <p>
    Click on any location marker to get started. Then click another marker to see the walking route.
  </p>

  <div class="welcome-route">
    <p id="route-line">
      <strong>Route:</strong> Select a starting site â†’ then choose another site.
    </p>
    <p id="route-info">
      <strong>Distance:</strong> â€” | <strong>Walking time:</strong> â€” 
    </p>
  </div>

  <button class="welcome-clear">Clear Route</button>
</div>

<div id="location-list"></div>
    </aside>

    <div class="map">
      <div id="map"></div>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    crossorigin=""
  ></script>

  <script>
    /* ---- 1. Locations with description + theme ---- */
    const locations = [
      {
        id: 1,
        name: "Place des MontrÃ©alaises",
        coords: [45.51349251464839, -73.54877633843134],
        address: "1 Pl. Ville-Marie, MontrÃ©al, QC H3B 2B6",
        image: "place-des-montrealaises.jpg",
        description:
          "Place des MontrÃ©alaises, inaugurated on May 16, 2025, is a new public space at Champ-de-Mars that links Old Montreal to the city centre and acts as a feminist site of memory. By incorporating symbolic elements like a mirrored installation engraved with the names of seven women: Jeanne Mance, Marie-JosÃ¨phe AngÃ©lique, Myra Cree, AgnÃ¨s Vautier, Jessie Maxwell Smith, Ida Roth Steinberg, and Idola St-Jean, as well as the 14 victims of the Ã‰cole Polytechnique feminicide, the space honours the women who shaped Montreal. The nearby Place Marie-JosÃ¨phe-AngÃ©lique was similarly renovated to draw attention to Canada's history of gendered violence and enslavement. When taken as a whole, these areas highlight the histories of women who have long been underrepresented in Montreal's urban environment.",
        theme:
          "The square shows how naming practices can repair erasures: womenâ€™s lives, which used to be absent from official stone and street signs, are brought into the centre of the cityâ€™s visual story."
      },
      {
        id: 2,
        name: "Grey Nuns Motherhouse",
        coords: [45.49533879399124, -73.57015843487274],
        address: "1190 Rue Guy",
        image: "grey-nuns.jpg",
        description:
          "The Grey Nuns were a Catholic womenâ€™s religious order whose members devoted their lives to care work that established Montrealâ€™s early social welfare system. They maintained hospitals, orphanages, seniorsâ€™ homes, and shelters for the needy, providing medical treatment, education, food, and lodging long before the state supplied these services. Inside the Motherhouse, they cooked, cleaned, nursed the sick, taught children, cared for unwed mothers, and assisted those facing poverty, disease, and disability. Their work formed the backbone of Montrealâ€™s institutional care, but it was carried out almost entirely within the restricted space of the convent and framed as domestic or religious duty rather than civic leadership.",
        theme:
          "The Motherhouse reveals how womenâ€™s unpaid religious labour built much of Montrealâ€™s social safety net, even while remaining under male ecclesial and state authority."
      },
      {
        id: 3,
        name: "Chez Doris",
        coords: [45.494730476445284, -73.59458908240381],
        address: "1430 Rue Chomedey",
        image: "chez-doris.jpg",
        description:
          "In the 1970s, Doris, a homeless woman, told a community worker that women like her needed a place to go without prying eyes or too many questions. Shortly after this interview she was murdered, and her story inspired the founding of Chez Doris in 1977 as a daytime refuge for women facing homelessness, violence, and poverty. Today, Chez Doris has grown into several service points offering safety, meals, counselling, and practical support to help women regain stability and autonomy.",
        theme:
          "Placed only a few blocks from former religious institutions, Chez Doris shows how the work of care has shifted from convents to community organizations, while structural inequalities that produce gendered precarity remain."
      },
      {
        id: 4,
        name: "Square Dorchester",
        coords: [45.503628717394356, -73.55788369114875],
        address: "Downtown Montreal",
        image: "square-dorchester.jpg",
        description:
          "Square Dorchester is one of downtown MontrÃ©alâ€™s most symbolically rich public spaces, filled with monuments that tell an official national story. The central equestrian monument to Lord Strathcona and the Boer War commemorates male military heroism and imperial participation, while no women are represented in the squareâ€™s major statues. In a city where only a small fraction of named spaces honour women, Dorchester Square exemplifies how public memory has celebrated male political and military figures while ignoring womenâ€™s contributions to urban life.",
        theme:
          "Square Dorchester highlights the imbalance between monumental male figures in stone and the almost invisible histories of women, service workers, and unhoused people who also occupy this space."
      },
      {
        id: 5,
        name: "Parc des Faubourgs",
        coords: [45.52801980243481, -73.55319782666079],
        address: "Near Papineau station, Centre-Sud",
        image: "parc-des-faubourgs.jpg",
        description:
          "Parc des Faubourgs lies near the Jacques-Cartier Bridge, bordered by busy roads and older working-class streets. Its name recalls historic working-class faubourgs such as Sainte-Marie and the Faubourg-Ã -mâ€™lasse. Recently, the park has hosted the Refus Local encampment, where advocates protested the dismantling of homeless camps during the housing crisis.",
        theme:
          "Parc des Faubourgs makes visible how housing precarity, addiction, and police surveillance shape public space, often putting already vulnerable peopleâ€”especially women experiencing homelessnessâ€”in even more danger while their stories remain absent from official commemoration."
      }
    ];
    /* ---- 2. Init map ---- */
const map = L.map("map").setView([45.505, -73.565], 13);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  maxZoom: 19
}).addTo(map);

const markerById = {};
const boundsPoints = [];

// For route logic
let startLoc = null;
let endLoc = null;
let routeLine = null;

// Elements in the welcome panel
const routeLineEl = document.getElementById("route-line");
const routeInfoEl = document.getElementById("route-info");
const clearBtn = document.querySelector(".welcome-clear");

// Create markers and add click logic
locations.forEach((loc) => {
  const card = document.createElement("article");
  card.className = "location-card";

  card.innerHTML = `
    ... your HTML for the card, including
    <div class="read-more-content"> ... </div>
<div class="read-more-toggle">â–¼</div>
  `;

  card.addEventListener("click", () => {
    const marker = markerById[loc.id];
    map.setView(loc.coords, 16);
    marker.openPopup();
  });

  listEl.appendChild(card);

  // ðŸ”½ THIS stays inside the forEach
  const toggle = card.querySelector(".read-more-toggle");
  const content = card.querySelector(".read-more-content");

  if (toggle && content) {
    toggle.addEventListener("click", (event) => {
      event.stopPropagation();            // so it doesn't trigger the card click
      const isOpen = content.classList.toggle("open");
      toggle.textContent = isOpen ? "â–²" : "â–¼";
    });
  }
}); // ðŸ”š closes locations.forEach

// ðŸ”½ THIS goes AFTER the loop, near your route code
clearBtn.addEventListener("click", clearRoute);

/* ---- 4. Route Logic ---- */

function handleMarkerClick(loc) {
  // If no starting location yet, set it
  if (!startLoc) {
    startLoc = loc;
    endLoc = null;
    if (routeLine) {
      map.removeLayer(routeLine);
      routeLine = null;
    }
    routeLineEl.innerHTML = `<strong>Route:</strong> ${loc.name} â†’ select another site.`;
    routeInfoEl.innerHTML = `<strong>Distance:</strong> â€” | <strong>Walking time:</strong> â€”`;
    return;
  }

  // If we have start but no end yet, and we clicked a different place
  if (!endLoc && loc.id !== startLoc.id) {
    endLoc = loc;
    updateRoute();
    return;
  }

  // Otherwise, start a new route from this location
  startLoc = loc;
  endLoc = null;
  if (routeLine) {
    map.removeLayer(routeLine);
    routeLine = null;
  }
  routeLineEl.innerHTML = `<strong>Route:</strong> ${loc.name} â†’ select another site.`;
  routeInfoEl.innerHTML = `<strong>Distance:</strong> â€” | <strong>Walking time:</strong> â€”`;
}

function updateRoute() {
  if (!startLoc || !endLoc) return;

  // Remove old line if present
  if (routeLine) {
    map.removeLayer(routeLine);
  }

  routeLine = L.polyline([startLoc.coords, endLoc.coords], {
    color: "#38bdf8",
    weight: 4
  }).addTo(map);

  map.fitBounds(routeLine.getBounds(), { padding: [60, 60] });

  const distanceKm = haversine(startLoc.coords, endLoc.coords);
  const walkingSpeedKmH = 5; // ~5 km/h typical
  const minutes = Math.round((distanceKm / walkingSpeedKmH) * 60);

  routeLineEl.innerHTML = `<strong>Route:</strong> ${startLoc.name} â†’ ${endLoc.name}`;
  routeInfoEl.innerHTML = `<strong>Distance:</strong> ${distanceKm.toFixed(2)} km | <strong>Walking time:</strong> ${minutes} min`;
}

function clearRoute() {
  startLoc = null;
  endLoc = null;
  if (routeLine) {
    map.removeLayer(routeLine);
    routeLine = null;
  }
  routeLineEl.innerHTML = `<strong>Route:</strong> Select a starting site â†’ then choose another site.`;
  routeInfoEl.innerHTML = `<strong>Distance:</strong> â€” | <strong>Walking time:</strong> â€”`;
}

function haversine(a, b) {
  const R = 6371; // earth radius in km
  const toRad = (d) => (d * Math.PI) / 180;

  const dLat = toRad(b[0] - a[0]);
  const dLon = toRad(b[1] - a[1]);
  const lat1 = toRad(a[0]);
  const lat2 = toRad(b[0]);

  const h =
    Math.sin(dLat / 2) ** 2 +
    Math.cos(lat1) * Math.cos(lat2) * Math.sin(dLon / 2) ** 2;

  return 2 * R * Math.asin(Math.sqrt(h));
}
  </script>
</body>
</html>
